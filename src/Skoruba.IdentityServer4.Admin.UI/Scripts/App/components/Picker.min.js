ko.bindingHandlers.modal={init:function(n,t){$(n).modal({show:!1});var i=t();if(ko.isObservable(i))$(n).on("hidden.bs.modal",function(){i(!1)})},update:function(n,t){var i=t();ko.utils.unwrapObservable(i)?$(n).modal("show"):$(n).modal("hide")}};ko.components.register("picker",{viewModel:function(n){var t=this;this.textTerm=ko.observable("").extend({rateLimit:500});this.minSearchText=ko.observable(n.minSearchText||2);this.multipleSelect=ko.observable(n.multipleSelect||!1);this.searchInputPlaceholder=ko.observable(n.searchInputPlaceholder||`Enter ${this.minSearchText()} or more characters`);this.selectedItemsTitle=ko.observable(n.selectedItemsTitle||"Selected: ");this.searchResultTitle=ko.observable(n.searchResultTitle||"Search result: ");this.suggestedItemsTitle=ko.observable(n.suggestedItemsTitle||"Suggested items: ");this.noItemSelectedTitle=ko.observable(n.noItemSelectedTitle||"No item/s selected");this.showAllItemsTitle=ko.observable(n.showAllItemsTitle||"more");this.allowSuggestedItems=ko.observable(n.allowSuggestedItems&&n.url||!1);this.topSuggestedItems=ko.observable(n.topSuggestedItems||5);this.allowItemAlreadySelectedNotification=ko.observable(n.allowItemAlreadySelectedNotification||!0);this.itemAlreadySelectedTitle=ko.observable(n.itemAlreadySelectedTitle||"item already selected");this.searchResult=ko.observableArray([]);this.selectedResult=ko.observableArray(n.selectedItems||[]);this.suggestedResult=ko.observableArray([]);this.loading=ko.observable(!1);this.isVisibleEditDialog=ko.observable(!1);this.editedItem=ko.observable("");this.editedItemOriginal=ko.observable("");const i=ko.toJSON(this.selectedResult);this.multipleSelect()===!0?this.selectedResult().length===0?$(`#${n.hiddenId}`).val(""):$(`#${n.hiddenId}`).val(i):this.selectedResult().length===0?$(`#${n.hiddenId}`).val(""):$(`#${n.hiddenId}`).val(this.selectedResult()[0]);this.textTerm.subscribe(function(i){i.trim()===""&&t.searchResult([]);i.trim()!==""&&i.trim().length>=t.minSearchText()&&(n.url?(t.loading(!0),$.get(`${n.url}=${i}`,function(n){n.indexOf(i)===-1&&n.push(i);t.searchResult(n);t.loading(!1)})):t.searchResult([i]))});this.notify=function(n){toastr.options.closeButton=!0;toastr.options.preventDuplicates=!0;toastr.info(`${n} ${this.itemAlreadySelectedTitle()}`)};this.notifyError=function(n){toastr.options.closeButton=!0;toastr.options.preventDuplicates=!0;toastr.error(n)};this.add=function(n){if(n=n.replace(/'/g,"").replace(/"/g,""),this.selectedResult.indexOf(n)>-1){this.allowItemAlreadySelectedNotification()===!0&&this.notify(n);return}this.multipleSelect()===!1?(this.selectedResult([]),this.selectedResult.push(n),this.clear(),this.sync()):this.multipleSelect()===!0&&(this.selectedResult.push(n),this.clear(),this.sync())};this.getSuggestedItems=function(){t.allowSuggestedItems()!==!1&&n.url&&(t.loading(!0),$.get(n.url,{limit:t.topSuggestedItems()},function(n){t.suggestedResult(n);t.loading(!1)}))};this.clear=function(){this.textTerm("");t.searchResult([])};this.showEditDialog=function(n){t.isVisibleEditDialog(!0);t.editedItem(n);t.editedItemOriginal(n)};this.submitEditDialog=function(){if(t.editedItem().trim()!==""){if(t.checkIfItemExists(t.editedItemOriginal().trim(),t.editedItem().trim())){t.notifyError(`${t.editedItem().trim()} ${this.itemAlreadySelectedTitle()}`);return}t.update(t.editedItemOriginal().trim(),t.editedItem().trim());t.isVisibleEditDialog(!1)}};this.checkIfItemExists=function(n,t){return n.trim()===t.trim()?!1:this.selectedResult.indexOf(t)>-1?!0:!1};this.update=function(n,i){for(var r=0;r<t.selectedResult().length;r++)if(t.selectedResult()[r]===n){t.selectedResult()[r]=i;t.selectedResult.valueHasMutated();break}t.sync()};this.remove=function(n){this.selectedResult.remove(n);this.sync()};this.showAll=function(){n.url&&(t.loading(!0),$.get(`${n.url}`,function(n){t.suggestedResult(n);t.loading(!1)}))};this.sync=function(){const t=ko.toJSON(this.selectedResult);this.multipleSelect()===!0?this.selectedResult().length===0?$(`#${n.hiddenId}`).val(""):$(`#${n.hiddenId}`).val(t):this.selectedResult().length===0?$(`#${n.hiddenId}`).val(""):$(`#${n.hiddenId}`).val(this.selectedResult()[0])};t.getSuggestedItems()},template:'<div class="card"><div class="card-body"><input class="form-control" data-bind="textInput: textTerm, attr: {placeholder: searchInputPlaceholder}" /><hr data-bind="visible: searchResult().length > 0" /><div data-bind="visible: searchResult().length > 0, text: searchResultTitle" class="search-title"><\/div><div class="block__buttons__add" data-bind="foreach: searchResult"><input type="button" class="btn btn-primary button__add" data-bind="value: $data, click: function() { $parent.add($data); }"><\/div><img data-bind="visible: loading()" src="/images/loading.gif" alt="Loading.." /><hr /><div data-bind="visible: selectedResult().length == 0, text: noItemSelectedTitle" class="search-title"><\/div><div data-bind="visible: selectedResult().length > 0, text: selectedItemsTitle" class="search-title"><\/div><div class="row" data-bind="foreach: selectedResult"><div class="col-12"><span class="button__text border-primary" data-bind="text: $data"><\/span><button class="btn btn-outline-primary button__update" data-bind="click: function() { $parent.showEditDialog($data) }"><span class="oi oi-pencil"><\/span><\/button><button class="btn btn-outline-primary button__delete" data-bind="click: function() { $parent.remove($data); }"><span class="oi oi-x"><\/span><\/button><\/div><\/div><hr data-bind="visible: suggestedResult().length > 0" /><div data-bind="visible: suggestedResult().length > 0, text: suggestedItemsTitle" class="search-title"><\/div><!-- ko foreach: suggestedResult --><input type="button" class="btn btn-light button__add" data-bind="value: $data, click: function() { $parent.add($data); }"><!-- /ko --><button class="btn btn-secondary button__show-all" data-bind="visible:allowSuggestedItems(), click: function() { $component.showAll(); }"><span data-bind="text: showAllItemsTitle"><\/span> <span class="oi oi-plus"><\/span><\/button><\/div><\/div><div class="modal fade" tabindex="-1" role="dialog" data-bind="modal:isVisibleEditDialog"><div class="modal-dialog"><div class="modal-content"> <div class="modal-header"><h5 data-bind="text: editedItemOriginal" class="modal-title"><\/h5><button type="button" class="close" data-dismiss="modal">&times;<\/button><\/div><div class="modal-body"><input class="form-control" type="hidden" data-bind="value: editedItemOriginal" /><input class="form-control" type="text" data-bind="value: editedItem" /><\/div><div class="modal-footer"><button type="button" class="btn btn-primary btn-xs" data-bind="click: submitEditDialog">OK<\/button><\/div><\/div><\/div><\/div>'});ko.applyBindings();